/** * Created by liudandan on 20163/18. */var express=require('express');var multer=require('multer');var ware = require('../ware');//指定上传的目录var upload=multer({dest:'public/uploads'})var User=require('../model').User;//这里是我们要的模型var router=express.Router();//返回一个路由中间件的实例router.get('/signup',ware.checkNotLogin,function (req,res) {    res.render('user/signup',{title:'用户注册'})});//upload.single('avatar') 描述上传属性router.post('/signup',ware.checkNotLogin,upload.single('avatar'),function (req,res) {    var user= req.body;    user.avatar='/uploads/'+req.file.filename;//获取uploads下面的图片    User.create(user,function (err,doc) {       if(err){           req.flash('error','用户名或密码错误');//=req.session.error='注册失败'           res.redirect('/back')       }else {          if(doc){              //把当前用户写入会话对象中              req.flash('sucess','用户登录成功')              res.redirect('/user/signin')          }else {              req.flash('error','用户名或密码错误');//=req.session.error='注册失败'              res.redirect('/back');          }       }    })});router.get('/signin',ware.checkNotLogin,function (req,res) {    res.render('user/signin',{title:'用户登录'});});router.post('/signin',function (req,res) {    var user=req.body;//    User.findOne(user,function (err,doc) {        if(err){            res.redirect('/back')        }else {            req.session.user=doc;//把当前用户写入会话对象中            res.redirect('/')        }    })})router.get('/signout',ware.checkMustLogin,function (req,res) {    req.session.user=null;//退出    res.redirect('/')});module.exports=router;/** * { fieldname: 'avatar', 表单的字段名name  originalname: 'baidu.png', 上传的文件的原始文件名  encoding: '7bit',  mimetype: 'image/png', 内容类型  destination: 'public/uploads' 上传的目标目录  filename: '52d2cf606d86e289530f6be31dc329ed', 保存文件名  path: 'public\\uploads\\52d2cf606d86e289530f6be31dc329ed',  size: 1636 } **/